var Composition = require("Composition");
var Vec2 = require("vec2");

module.exports = function(){
	var TerrainDestroyer = new Composition();

	TerrainDestroyer.draw = function(){
		var terrain = engine.find("terrain");
		
		var x = Math.floor(this.base.transform.position.x + this.base.renderer.vertices.topLeft.x);
		var y = Math.floor(this.base.transform.position.y + this.base.renderer.vertices.topLeft.y);
		var w = this.base.renderer.vertices.bottomRight.x - this.base.renderer.vertices.topLeft.x;
		var h = this.base.renderer.vertices.bottomRight.y - this.base.renderer.vertices.topLeft.y;
		
		var imgDataSquare = this.base.renderer.canvas.context.getImageData(x, y, w, h);
		var imgData = terrain.components.renderer.imageData;
		
		for(var i = y; i < y+h; i++){
			for(var j = x; j < x+w; j++){
				if(imgData.data[i*3200+j*4+3] == 0 || imgData.data[i*3200+j*4+3] == undefined){
					continue;
				}else{
					if(imgDataSquare.data[(i-y)*w*4+(j-x)*4+3] != 0){
						imgData.data[i*3200+j*4+3]=0;
						this.base.life.life--;
					}
				}
			}
		}

		terrain.components.renderer.canvas.context.putImageData(imgData,0,0);
		
	}
	return TerrainDestroyer;
}