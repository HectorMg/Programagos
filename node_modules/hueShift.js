module.exports = function(imagePath, hue, callback){
	var image = document.createElement("img");
	image.src = imagePath;
	image.onload = function(){
		var canvas = document.createElement("canvas");
		canvas.width = image.width;
		canvas.height = image.height;

		var context = canvas.getContext("2d");
		
		context.drawImage(image, 0, 0);
		
		var imgData = context.getImageData(0, 0, image.width, image.height);
		var U = Math.cos(hue*Math.PI/180);
		var W = Math.sin(hue*Math.PI/180);

		for (var i = 0; i < imgData.data.length; i+=4) {
			//If we are currently in a visible pixel
			if(imgData.data[i+3]!=0){

				//Magic function that shifts an RGB color hue.
				//This needs to be really fast, sorry for readability.
				//src: http://stackoverflow.com/questions/8507885/shift-hue-of-an-rgb-color
				var r = imgData.data[i];
				var g = imgData.data[i+1];
				var b = imgData.data[i+2];

				imgData.data[i] = (U + (1 - U) / 3) * r +
				(0.333 * (1.0 - U) - 0.577 * W) * g +
				(0.333 * (1.0 - U) + 0.577 * W) * b;

				imgData.data[i+1] = (0.333 * (1.0 - U) + 0.577 * W) * r +
				(U + 0.333*(1.0 - U)) * g +
				(0.333 * (1.0 - U) - 0.577 * W) * b;

				imgData.data[i+2] = (0.333 * (1.0 - U) - 0.577 * W) * r +
				(0.333 * (1.0 - U) + 0.577 * W) * g +
				(U + 0.333 * (1.0 - U)) * b;

			}
		}

		context.putImageData(imgData,0,0);
		callback(canvas);

	}
}