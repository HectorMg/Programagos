var Composition = require('Composition');
var Vec2 = require('vec2');
var Vertices = require('Vertices');
var VertexRenderer = require('VertexRenderer');
var rectangle = require("Rectangle");
var Transform = require("Transform");

module.exports = function(){
  var LifeBar = new Composition(
    'transform', Transform(10, -10),
    'rendererBack', VertexRenderer(new Vertices(rectangle(new Vec2(-20, -5), new Vec2(20, 5))), -2),
    'rendererFront', VertexRenderer(new Vertices(rectangle(new Vec2(-17, -3), new Vec2(17, 3))), -1)
  );

  var origWidth = 0;
  var topLeft = new Vec2(0,0);
  var bottomRight = new Vec2(0,0);

  LifeBar.start = function(){
    this.components.rendererFront.static = false;
    this.components.rendererBack.static = false;
    this.components.transform.parent = this.base.transform.position;

    this.components.rendererBack.fillStyle = "#bdc3c7";
    this.components.rendererFront.fillStyle = "#3498db";

    origWidth = this.components.rendererFront.vertices.bottomRight.x - this.components.rendererFront.vertices.topLeft.x;
    topLeft = this.components.rendererFront.vertices.topLeft.clone();
    bottomRight = this.components.rendererFront.vertices.bottomRight.clone();
  }

  LifeBar.update = function(){
    bottomRight.x = topLeft.x + (origWidth * this.base.steps.percentage);

    this.components.rendererFront.vertices = new Vertices(rectangle(topLeft, bottomRight));
  }
  return LifeBar;
}
