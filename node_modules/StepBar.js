var Composition = require('Composition');
var Vec2 = require('vec2');
var Vertices = require('Vertices');
var VertexRenderer = require('VertexRenderer');
var rectangle = require("Rectangle");
var Transform = require("Transform");

module.exports = function(){
  var LifeBar = new Composition(
    'transform', Transform(10, -10),
    'rendererBack', VertexRenderer(new Vertices(rectangle(new Vec2(-20, -5), new Vec2(20, 5))), 2),
    'rendererFront', VertexRenderer(new Vertices(rectangle(new Vec2(-17, -3), new Vec2(17, 3))), 3)
  );

  var origWidth = 0;
  LifeBar.start = function(){
    this.components.rendererFront.static = false;
    this.components.rendererBack.static = false;
    this.components.transform.parent = this.base.transform.position;

    this.components.rendererBack.fillStyle = "#bdc3c7";
    this.components.rendererFront.fillStyle = "#3498db";

    origWidth = this.components.rendererFront.vertices.bottomRight.x - this.components.rendererFront.vertices.topLeft.x;

  }

  LifeBar.update = function(){

    var lifePercentage = this.base.steps.percentage;


    var topLeft = this.components.rendererFront.vertices.topLeft.clone();
    var bottomRight = this.components.rendererFront.vertices.bottomRight.clone();

    var width = origWidth * lifePercentage;
    bottomRight.x = topLeft.x + width;

    this.components.rendererFront.vertices = new Vertices(rectangle(topLeft, bottomRight));
  }
  return LifeBar;
}
