var Composition = require('Composition');
var Vec2 = require('vec2');
var Vertices = require('Vertices');
var VertexRenderer = require('VertexRenderer');
var rectangle = require("Rectangle");
var Transform = require("Transform");

module.exports = function(){
  var LifeBar = new Composition(
    'transform', Transform(10, -20),
    'rendererBack', VertexRenderer(new Vertices(rectangle(new Vec2(-20, -5), new Vec2(20, 5))), 2),
    'rendererFront', VertexRenderer(new Vertices(rectangle(new Vec2(-17, -3), new Vec2(17, 3))), 3)
  );

  var origWidth = 0;
  LifeBar.start = function(){
    this.components.rendererFront.static = false;
    this.components.rendererBack.static = false;
    this.components.transform.parent = this.base.transform.position;
    
    this.components.rendererBack.fillStyle = "#bdc3c7";
    this.components.rendererFront.fillStyle = "#2ecc71";

    origWidth = this.components.rendererFront.vertices.bottomRight.x - this.components.rendererFront.vertices.topLeft.x;

  }

  LifeBar.update = function(){

    var lifePercentage = this.base.life.life;

    if(lifePercentage <= 0.66){
      this.components.rendererFront.fillStyle = "#f39c12";
    }
    if(lifePercentage <= 0.33){
      this.components.rendererFront.fillStyle = "#c0392b";
    }

    var topLeft = this.components.rendererFront.vertices.topLeft.clone();
    var bottomRight = this.components.rendererFront.vertices.bottomRight.clone();

    var width = origWidth * lifePercentage;
    bottomRight.x = topLeft.x + width;

    this.components.rendererFront.vertices = new Vertices(rectangle(topLeft, bottomRight));
  }
  return LifeBar;
}
