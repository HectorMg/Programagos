var Composition = require('Composition');
var Vec2 = require('vec2');
var Vertices = require('Vertices');
var VertexRenderer = require('VertexRenderer');
var rectangle = require("Rectangle");
var Transform = require("Transform");

module.exports = function(){
  var LifeBar = new Composition(
    'rendererBack', VertexRenderer(new Vertices(rectangle(new Vec2(-20, -5), new Vec2(20, 5))), 20),
    'rendererFront', VertexRenderer(new Vertices(rectangle(new Vec2(-17, -3), new Vec2(17, 3))), 30),
    'transform', Transform(10, -20)
  );

  LifeBar.start = function(){
    this.components.rendererFront.static = false;
    this.components.rendererBack.static = false;
    this.components.transform.parent = this.base.transform.position;
    
    this.components.rendererBack.fillStyle = "#bdc3c7";
    this.components.rendererFront.fillStyle = "#2ecc71";

  }

  LifeBar.update = function(){

    var lifePercentage = this.base.life.life
    console.log("position" + JSON.stringify(this.base.transform.position));

    if(lifePercentage <= 0.75){
      this.components.rendererFront.fillStyle = "#f39c12";
    }
    if(lifePercentage <= 0.50){
      this.components.rendererFront.fillStyle = "#c0392b";
    }

    var topLeft = this.components.rendererFront.vertices.topLeft;
    var bottomRight = this.components.rendererFront.vertices.bottomRight;

    var width = (bottomRight.x - topLeft.x) * lifePercentage;

    bottomRight.x = topLeft.x + width;

    this.components.rendererFront.vertices = new Vertices(rectangle(topLeft, bottomRight));
  }
  return LifeBar;
}
