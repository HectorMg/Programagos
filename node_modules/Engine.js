var Composition = require('Composition');

module.exports =(function(){

	//Constructor
	function Engine(context, mainComposition){
		//Private-Instance properties
		var pastTime = 0;

		//Private-Instance method
		function frame(){
			//Get time in milliseconds
			mainComposition.time = window.performance.now();

			//Get time diference
			var timeDelta = mainComposition.time-pastTime;
			//Call update and draw
			mainComposition._update(timeDelta*0.001);
			context.clearRect(0,0,800,500);
			mainComposition._draw(context, timeDelta*0.001);

			//Set past time as current time
			pastTime = mainComposition.time;
			
			//If the engine is still running, loop
			if(isRunning){
				window.requestAnimationFrame(frame);
			}
		}

		//Call all start functions
		mainComposition._start();
		//Call frame
		window.requestAnimationFrame(frame);
	}

	//Private-Shared Properties
	var isRunning = true;
	
	Engine.prototype.quit = function(){
		isRunning = false
	}

	//Return prototype
	return Engine;

})();