var Composition = require('Composition');
var Canvas = require('Canvas');
var Vertices = require('Vertices');

module.exports = function(vertices, zIndex){
	//Create an empty Composition
	var Renderer = new Composition();

	Renderer.vertices = new Vertices(vertices);
	//Mode can be either 'fill', 'stroke', or 'both'
	Renderer.mode = "fill";

	//Set default fillStyle. Can be color, gradient or pattern
	Renderer.fillStyle = "#000000";

	//Set default strokeStyle. Can be color, gradient or pattern
	Renderer.strokeStyle = "#000000";

	//Set default lineWidth to 1px;
	Renderer.lineWidth = 1;

	Renderer.canvas = new Canvas();
	Renderer.canvas.setZIndex(zIndex || 0);

	Renderer.draw = function(timeDelta){
		this.canvas.context.clearRect(
			this.base.transform.x+this.vertices.topLeft.x,
			this.base.transform.y+this.vertices.topLeft.y,
			this.vertices.bottomRight.x - this.vertices.topLeft.x,
			this.vertices.bottomRight.y - this.vertices.topLeft.y
		);
		this.canvas.context.beginPath();

		//Move to starting position
		this.canvas.context.moveTo(this.vertices.vertices[0].x+this.base.transform.x, this.vertices.vertices[0].y+this.base.transform.y);
		
		//Make a line to the next vertex
		for(var vertex = 1; vertex < this.vertices.vertices.length; vertex++){
			this.canvas.context.lineTo(this.vertices.vertices[vertex].x+this.base.transform.x, this.vertices.vertices[vertex].y+this.base.transform.y);
		}


		if(this.mode=="fill"){
			this.canvas.context.fillStyle = this.fillStyle;
			this.canvas.context.fill();
		}else if(this.mode=="stroke"){
			this.canvas.context.strokeStyle = this.strokeStyle;
			this.canvas.context.lineWidth = this.lineWidth;
			this.canvas.context.stroke();
		}else if(this.mode=="both"){
			this.canvas.context.fillStyle = this.fillStyle;
			this.canvas.context.fill();
			this.canvas.context.strokeStyle = this.strokeStyle;
			this.canvas.context.lineWidth = this.lineWidth;
			this.canvas.context.stroke();
		}
	}
	
	//Return the created Composition
	return Renderer;
}