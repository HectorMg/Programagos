var Composition = require('Composition');

var HueManipulator = new Composition();

HueManipulator.hue = Math.random()*360;

HueManipulator.start = function(){
	var context = this.base.renderer.canvas.context;

	var imgData = context.getImageData(0, 0, 800, 500);

	var U = Math.cos(this.hue*Math.PI/180);
	var W = Math.sin(this.hue*Math.PI/180);

	for (var i = 0; i < imgData.data.length; i+=4) {

		//Magic function that shifts an RGB color hue.
		//This needs to be really fast, sorry for readability.
		//src: http://stackoverflow.com/questions/8507885/shift-hue-of-an-rgb-color
		var r = imgData.data[i];
		var g = imgData.data[i+1];
		var b = imgData.data[i+2];
		imgData.data[i] =
		(.299+.701*U+.168*W)*r
		+ (.587-.587*U+.330*W)*g
		+ (.114-.114*U-.497*W)*b;

		imgData.data[i+1] =
		(.299-.299*U-.328*W)*r
		+ (.587+.413*U+.035*W)*g
		+ (.114-.114*U+.292*W)*b;

		imgData.data[i+2] =
		(.299-.3*U+1.25*W)*r
		+ (.587-.588*U-1.05*W)*g
		+ (.114+.886*U-.203*W)*b;
	}

	context.putImageData(imgData,0,0);
}

HueManipulator.draw = function(){
	if(!this.base.renderer.static){
		this.start();
	}

}

module.exports = HueManipulator;
