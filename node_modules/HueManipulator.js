var Composition = require('Composition');

var HueManipulator = new Composition();

<<<<<<< HEAD
HueManipulator.hue = 0;
=======
HueManipulator.hue = Math.random()*360;
>>>>>>> 71c331f7a302ba89e89b0dcebf505774e254a8f3

HueManipulator.start = function(){
	var context = this.base.renderer.canvas.context;

	var imgData = context.getImageData(0, 0, 800, 500);

	var U = Math.cos(this.hue*Math.PI/180);
	var W = Math.sin(this.hue*Math.PI/180);

	for (var i = 0; i < imgData.data.length; i+=4) {
		//If we are currently in a visible pixel
		if(imgData.data[i+3]!=0){

<<<<<<< HEAD
			//Magic function that shifts an RGB color hue.
			//This needs to be really fast, sorry for readability.
			//src: http://stackoverflow.com/questions/8507885/shift-hue-of-an-rgb-color
			var r = imgData.data[i];
			var g = imgData.data[i+1];
			var b = imgData.data[i+2];

			imgData.data[i] = (U + (1 - U) / 3) * r +
			(0.333 * (1.0 - U) - 0.577 * W) * g +
			(0.333 * (1.0 - U) + 0.577 * W) * b;

			imgData.data[i+1] = (0.333 * (1.0 - U) + 0.577 * W) * r +
			(U + 0.333*(1.0 - U)) * g +
			(0.333 * (1.0 - U) - 0.577 * W) * b;

			imgData.data[i+2] = (0.333 * (1.0 - U) - 0.577 * W) * r +
			(0.333 * (1.0 - U) + 0.577 * W) * g +
			(U + 0.333 * (1.0 - U)) * b;

		}
=======
		//Magic function that shifts an RGB color hue.
		//This needs to be really fast, sorry for readability.
		//src: http://stackoverflow.com/questions/8507885/shift-hue-of-an-rgb-color
		var r = imgData.data[i];
		var g = imgData.data[i+1];
		var b = imgData.data[i+2];
		imgData.data[i] =
		(.299+.701*U+.168*W)*r
		+ (.587-.587*U+.330*W)*g
		+ (.114-.114*U-.497*W)*b;

		imgData.data[i+1] =
		(.299-.299*U-.328*W)*r
		+ (.587+.413*U+.035*W)*g
		+ (.114-.114*U+.292*W)*b;

		imgData.data[i+2] =
		(.299-.3*U+1.25*W)*r
		+ (.587-.588*U-1.05*W)*g
		+ (.114+.886*U-.203*W)*b;
>>>>>>> 71c331f7a302ba89e89b0dcebf505774e254a8f3
	}

	context.putImageData(imgData,0,0);
}

HueManipulator.draw = function(){
	if(!this.base.renderer.static){
		this.start();
	}

}

module.exports = HueManipulator;
