//Spell ball that is cast by players

var Composition = require("Composition");
var testController = require("testController");
var Rigidbody = require("Rigidbody");
var VertexRenderer = require("VertexRenderer");
var Vertices = require("Vertices");
var Transform = require("Transform");
var TerrainDestroyer = require("TerrainDestroyer");
var Vec2 = require('vec2');
var Circle = require('Circle');
var LifeComponent = require("LifeComponent");
var LifeBar = require("LifeBar");


module.exports = function(caster){
	var SpellBall = new Composition(
		'transform', Transform(200,100),
		'rigidbody', Rigidbody(),
		'renderer', VertexRenderer(new Vertices(Circle(10,10)),-5), //Used for collision detection
		'glow', VertexRenderer(new Vertices(Circle(15,15)),3,"hard-light"), //Adds a glow effect
		'destroyer', TerrainDestroyer(),
		'life', LifeComponent(),
		'LifeBar', LifeBar()
	);

	SpellBall.start = function(){
		console.log("Start!");
		// //Set casting player
		this.caster = caster;
		//Set renderers to static
		this.components.renderer.static = false;
		this.components.glow.static = false;

		this.components.rigidbody.acceleration.y = 100;
		this.components.rigidbody.speed.x = 100;
	}

	SpellBall.update = function(deltaTime){
		//If its life has ended, destroy.
		if(this.components.life.percentage <= 0){
			this.destroy();
		}
	}
	SpellBall.draw = function(){
		//Create a radial gradient to be used in glow component
		var grd = this.components.glow.canvas.context.createRadialGradient(
			this.components.transform.position.x,
			this.components.transform.position.y,
			0,
			this.components.transform.position.x,
			this.components.transform.position.y,
			20
		);

		//White at .3 from center
		grd.addColorStop(0.3,"rgba(255,255,255, 1)");
		//Oscillating blue from 0.45 - 0.55 from center at 0.5 transparency
		grd.addColorStop(0.5+0.05*Math.cos(window.performance.now()*0.01),"rgba(0, 234, 230, 0.5)");
		//Green at end at 0 transparency
		grd.addColorStop(1,"rgba(0, 239, 23, 0)");

		//Set gradient to glow component
		this.components.glow.fillStyle = grd;
	}

	return SpellBall
}
