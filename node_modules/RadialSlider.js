var Composition = require('Composition');
var Circle = require('Circle');
var Vec2 = require('vec2');
var Transform = require('Transform');
var VertexRenderer = require('VertexRenderer');
var Vertices = require('Vertices');
var Circle = require('Circle');

module.exports = function(){
	var RadialSlider = new Composition(
		'transform', Transform(0,0),
		'renderer', VertexRenderer(new Vertices(Circle(50,20)))

	);

	RadialSlider.radius = 50;

	RadialSlider.start = function(){
		this.components.transform.parent = this.base.transform.position;

		this.components.renderer.static = false;
		this.components.renderer.strokeStyle = "#f39c12";
		this.components.renderer.lineWidth = 3;
		this.components.renderer.mode = "stroke";
		this.components.renderer.canvas.context.setLineDash([5, 15]);

		var handle = new Composition(
			'transform', Transform(0,50),
			'renderer', VertexRenderer(new Vertices(Circle(10,10)))
		)
		this.add('handle', handle);
		this.components.handle.components.renderer.fillStyle = "#f39c12";
		this.components.handle.components.renderer.static = false;
		this.components.handle.components.transform.parent = this.components.transform.position;
	}

	RadialSlider.mousedrag = function(x,y){
		dx = x-this.components.transform.position.x;
		dy = y-this.components.transform.position.y;

		var scale = 50/Math.sqrt(dx*dx+dy*dy);

		this.components.handle.components.transform.localPosition.x = dx*scale;
		this.components.handle.components.transform.localPosition.y = dy*scale;
	}

	RadialSlider.update = function(){
		this.components.renderer.vertices = new Vertices(Circle(this.radius, 20));
		this.components.handle.components.transform.localPosition.normalize();
		this.components.handle.components.transform.localPosition.multiply(this.radius);
	}



	return RadialSlider;
}
