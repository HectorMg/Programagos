var Composition = require('Composition');
var Renderer = require('VertexRenderer');
var Transform = require('Transform');
//var Collider = require('VertexCollider');

var terrain = new Composition(
	'renderer', Renderer([]),
	'transform', Transform(0,250)
	//'collider', Collider()
);

var cosInterpolate = function(a, b, t){
		var ft = t*Math.PI;
		var f = (1-Math.cos(ft))*0.5;
		return  a*(1-f) + b*f;
	}

var randomArray = function(size){
	var result = [];
	result[0] = Math.random()*2-1;
	for(var i = 1; i < size; i++){
		var r = Math.random()*2-1;
		var e = Math.exp(-Math.pow(r, 2)/2);
		result[i] = result[i-1] + r*e*0.4;
	}
	return result;
}

var noise = function(arrayRandom, size, t){
	var pointCount = arrayRandom.length-1;
	var currentPoint = Math.floor(pointCount*t/size);
	
	return cosInterpolate(arrayRandom[currentPoint]*100,
						  arrayRandom[currentPoint+1]*100,
						  (t-currentPoint/pointCount*size)/(size/pointCount));
}

terrain.start = function(){
	this.components.renderer.mode = "both";
	this.components.renderer.fillStyle="#11DD11";
	this.components.renderer.strokeStyle="#000000";

	this.components.renderer.vertices[0] = {x:0, y:500};
	var baseArray = randomArray(9);
	console.log(randomArray);
	for(var i = 0; i < 800; i++){
		this.components.renderer.vertices[i+1] = {x:i, y:noise(baseArray, 800, i)};
	}
	this.components.renderer.vertices[i+1] = {x:800, y:500}; 
}

module.exports = terrain;