var Composition = require("Composition");
var VertexRenderer = require("VertexRenderer");
var Vertices = require("Vertices");
var Transform = require("Transform");
var Vec2 = require("vec2");

module.exports = function(){
	var sky = new Composition(
		"transform", Transform(0,0),
		"renderer", VertexRenderer(null,-1),
		"foreground", VertexRenderer(null,1, "multiply")
	);

	sky.start = function(){
		//Make a rectangle if the size of the window
		var verts = new Vertices([
			new Vec2(0,0),
		 	new Vec2(800,0),
		 	new Vec2(800,500), 
		 	new Vec2(0,500)
		 ]);
		this.components.renderer.vertices = verts;
		this.components.foreground.vertices = verts;
		this.components.foreground.static = false;

		var context = this.components.renderer.canvas.context;
		
		//Make a gradient
		var gradient=context.createLinearGradient(0,0,0,170);
		gradient.addColorStop(0,"#004199");
		gradient.addColorStop(1,"#80b6ff");

		//Set the gradient
		this.components.renderer.fillStyle = gradient;
	}

	sky.update = function(){
		//Oscillate alpha value from 0-0.8. In sync with sun.
		this.components.foreground.fillStyle = "rgba(74,36,54,"+(0.4-0.4*Math.cos(window.performance.now()*0.001))+")";
		
	}

	return sky;
}