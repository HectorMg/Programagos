var vm = require('vm');
var Composition = require("Composition");

module.exports = function(console){
	var PlayerScriptRunner = new Composition();

	PlayerScriptRunner.runScript = function(code){

		//Create a vm.Script from 'code' parameter which should contain player's js code.
		var script = new vm.Script(code, {filename: "Player's Code"});

		//This is an object which will later be used to expose the functions inside it as the player api.
		var sandbox = {
			print: function(code){
				console.value = code;
			},
			move:function(param1, param2){
				console.value =("move");
			},
			changeColor:function(){
				console.value =("changeColor");
			},
			changeRadius:function(){
				console.value =("changeRadius");
			}
		}

		//Create sandbox from object
		var context = new vm.createContext(sandbox);

		//Run script
		script.runInContext(context, {timeout:200});
	}
	return PlayerScriptRunner;
}
