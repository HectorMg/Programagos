var Composition = require("Composition");
var playAudio = require("playAudio");

module.exports = function(){
	var CollisionManager = new Composition();

	CollisionManager.players = Array.prototype.slice.call(arguments);;
	var collision = function(img,b){
		return (img.components.renderer.image.width + img.components.transform.position.x > b.components.renderer.vertices.topLeft.x + b.components.transform.position.x
				&& b.components.renderer.vertices.bottomRight.x + b.components.transform.position.x > img.components.transform.position.x
				&& img.components.renderer.image.height + img.components.transform.position.y > b.components.renderer.vertices.topLeft.y + b.components.transform.position.y
				&& b.components.renderer.vertices.bottomRight.y + b.components.transform.position.y > img.components.transform.position.y);
	}


	CollisionManager.update = function(){
		var spell = engine.find("spell");

		if(spell!=null){
			for(var i = 0; i < this.players.length; i++){
				if ((spell.caster != this.players[i]) && (collision(this.players[i], spell))){
					spell.destroy();
					playAudio("resources/hurtSound.ogg");
					this.players[i].components.life.percentage -= 0.2;
					spell.caster.components.GameScore.addHit();
					spell.caster.endTurn();
				}
			}
		}
	}

	CollisionManager.addPlayers = function(){
		this.players = this.players.concat(Array.prototype.slice.call(arguments));
	}

	CollisionManager.removePlayer = function(player){
		for (var i = 0; i < this.players.length; i++){
			if(this.players[i].name == player.name){
				this.players.splice(i,1);
			}
		}
	}

	return CollisionManager;
}
