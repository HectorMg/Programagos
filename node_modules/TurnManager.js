var Composition = require('Composition');
var Vec2 = require('vec2');

module.exports = function(){

	var TurnManager = new Composition();

	TurnManager.players = Array.prototype.slice.call(arguments);
	//var counter = players.length;

	TurnManager.start = function(){
		this.activePlayer = 0;

		this.players[0].setActive(true);
		for(var player = 1; player<this.players.length; player++){
			this.players[player].setActive(false);
		}
	}

	TurnManager.nextTurn = function(){
		this.players[this.activePlayer].setActive(false);
		this.players[this.activePlayer].components.rigidbody.speed = new Vec2(0,0);
		this.activePlayer = (this.activePlayer + 1) % this.players.length;
		this.players[this.activePlayer].setActive(true);
	}

	TurnManager.keydown = function(key){
		if(key==77){
			this.players[this.activePlayer].endTurn();
		}
	}

	TurnManager.addPlayers = function(){
		this.players = this.players.concat(Array.prototype.slice.call(arguments));
	}

	TurnManager.removePlayer = function(player){
		for (var i = 0; i < this.players.length; i++){
			console.log(""+i+", "+this.players[i].name+"=="+player.name);
			if(this.players[i].name == player.name){
				console.log("Removing "+player.name+" from tm.");
				this.players.splice(i,1);
			}
		}


		if(this.players.length==1){
			this.players[0].win();
			console.log(this.players[0].name+" won");
			console.log("quitting");
			engine.quit();
		}
	}

	return TurnManager;
}
